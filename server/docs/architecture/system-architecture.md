# 系统架构设计文档

## 1. 总体架构概述

本系统采用经典的三层架构模式，结合现代化的微服务理念和前后端分离架构设计。

### 1.1 架构设计原则

1. **分层原则**：明确的分层结构，各层职责清晰
2. **松耦合原则**：各模块间依赖关系最小化
3. **高内聚原则**：相关功能集中在同一模块内
4. **可扩展性原则**：架构支持功能扩展和性能扩展
5. **安全性原则**：完善的安全机制和权限控制

### 1.2 技术架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户层                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   用户端    │  │   管理端    │  │   移动端    │          │
│  │  (Vue3)     │  │  (Vue3)     │  │  (响应式)   │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
                              │
                       ┌─────────────┐
                       │   网关层     │
                       │   (Nginx)   │
                       └─────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                       应用层                                 │
│  ┌─────────────────────────────────────────────────────────┐ │
│  │                SpringBoot应用                            │ │
│  │  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐      │ │
│  │  │控制器层 │ │业务逻辑层│ │数据访问层│ │  AI服务  │      │ │
│  │  │Controller│ │Service │ │ Mapper  │ │AiChat   │      │ │
│  │  └─────────┘ └─────────┘ └─────────┘ └─────────┘      │ │
│  └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                       数据层                                 │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │   MySQL     │  │    Redis    │  │   文件存储   │          │
│  │  (主数据库)  │  │   (缓存)    │  │  (图片等)   │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
                              │
┌─────────────────────────────────────────────────────────────┐
│                      外部服务                                │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐          │
│  │火山引擎DeepSeek│ │   支付接口   │  │   物流接口   │          │
│  │   AI服务     │  │   (预留)    │  │   (预留)    │          │
│  └─────────────┘  └─────────────┘  └─────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

## 2. 架构层次详细设计

### 2.1 表现层（Presentation Layer）

**技术选型**：Vue 3 + Ant Design Vue + Vite

**主要职责**：
- 用户界面展示
- 用户交互处理
- 数据校验
- 状态管理

**核心组件**：
- 用户端界面：商品浏览、购物车、订单管理、AI客服
- 管理端界面：商品管理、用户管理、订单管理、系统监控

### 2.2 业务逻辑层（Business Logic Layer）

**技术选型**：SpringBoot + Spring MVC + MyBatis-Plus

**主要职责**：
- 业务规则实现
- 事务管理
- 权限控制
- 缓存管理

**核心模块**：
- 用户管理服务：注册、登录、权限验证
- 商品管理服务：商品CRUD、分类管理、库存管理
- 订单管理服务：订单创建、支付处理、状态跟踪
- AI客服服务：智能对话、商品推荐、知识库管理

### 2.3 数据访问层（Data Access Layer）

**技术选型**：MyBatis-Plus + HikariCP

**主要职责**：
- 数据持久化
- 数据查询优化
- 连接池管理
- 事务控制

### 2.4 外部服务集成层

**AI服务集成**：
- 火山引擎DeepSeek V3 API
- 智能对话处理
- 商品信息分析
- 用户意图识别

## 3. 关键技术决策

### 3.1 前后端分离架构

**优势**：
- 开发效率高，前后端可并行开发
- 技术栈独立，便于技术选型和升级
- 支持多端适配（Web、移动端）
- API标准化，便于扩展

### 3.2 SpringBoot微服务框架

**选择理由**：
- 快速开发和部署
- 内置Tomcat，简化部署流程
- 丰富的生态系统
- 优秀的监控和管理特性

### 3.3 AI服务集成方案

**技术实现**：
- RestTemplate HTTP客户端
- 商品信息实时缓存
- 会话状态管理
- 错误处理和降级策略

## 4. 性能优化策略

### 4.1 缓存策略

- **商品信息缓存**：5分钟本地缓存，减少数据库查询
- **用户会话缓存**：Session管理优化
- **静态资源缓存**：CDN加速（可扩展）

### 4.2 数据库优化

- **连接池配置**：HikariCP连接池优化
- **索引设计**：关键字段索引优化
- **查询优化**：N+1问题解决，懒加载策略

### 4.3 API性能优化

- **分页查询**：大数据量分页处理
- **异步处理**：AI请求异步化
- **限流控制**：防止接口被恶意调用

## 5. 安全架构

### 5.1 认证授权

- **用户认证**：Token-based认证机制
- **权限控制**：基于角色的访问控制(RBAC)
- **会话管理**：安全的会话管理策略

### 5.2 数据安全

- **SQL注入防护**：MyBatis参数化查询
- **XSS防护**：前端输入校验和后端过滤
- **CSRF防护**：跨站请求伪造防护

### 5.3 API安全

- **HTTPS协议**：数据传输加密
- **API密钥管理**：外部服务认证
- **请求限流**：防止接口滥用

## 6. 可扩展性设计

### 6.1 水平扩展

- 微服务架构支持
- 负载均衡配置
- 数据库读写分离（可扩展）

### 6.2 功能扩展

- 插件化架构支持
- 新支付方式接入
- 多语言支持
- 推荐算法升级

### 6.3 技术扩展

- 容器化部署支持
- 云原生架构迁移
- 大数据分析集成
- 机器学习模型集成